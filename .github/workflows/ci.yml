name: 🧪 CI - Tests & Quality

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  # Use the shared ci-tooling reusable workflow
  ci:
    name: 🔄 CI Pipeline
    uses: provide-io/ci-tooling/.github/workflows/python-ci.yml@v0.0.0
    with:
      python-version: '3.11'
      source-paths: 'src/ tests/'
      test-directory: 'tests/'
      coverage-threshold: 75
      run-security: true
      matrix-testing: true
      os-matrix: 'ubuntu-latest,macos-latest'
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}

  # Optional: Individual actions for custom needs
  custom-checks:
    name: 🔧 Custom Checks
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4

      - name: 🐍 Setup Python Environment
        uses: provide-io/ci-tooling/actions/setup-python-env@v0.0.0
        with:
          python-version: '3.11'
          install-extras: 'dev'

      - name: 🧪 Custom Integration Tests
        run: |
          source workenv/bin/activate
          pytest tests/ -m integration -v || true

      - name: 📦 Build Package
        uses: provide-io/ci-tooling/actions/python-build@v0.0.0